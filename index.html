<!DOCTYPE html>
<html>
  <head>
    <title>Receita 07</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cervejarias</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      h1 {
        color: #333;
        font-size: 2rem;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        font-size: 1rem;
        margin-bottom: 20px;
      }

      #botaoCarregar {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        border-radius: 5px;
        cursor: pointer;
      }

      #botaoCarregar:hover {
        background-color: #0056b3;
      }

      #botaoCarregar:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }

      #cervejasDiv {
        margin-top: 40px;
      }

      .cervejarias-grid {
        margin-top: 20px;
      }

      .cervejaria-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 10px;
      }

      .cervejaria-name {
        font-size: 1.1rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
      }

      .cervejaria-details {
        color: #666;
        line-height: 1.4;
      }

      .cervejaria-type {
        display: inline-block;
        background-color: #e9ecef;
        color: #495057;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.8rem;
        margin: 5px 0;
      }

      .cervejaria-location {
        color: #666;
        font-size: 0.9rem;
        margin-top: 5px;
      }

      .loading {
        text-align: center;
        color: #666;
        font-size: 1rem;
        margin-top: 20px;
      }

      .error {
        background-color: #f8d7da;
        color: #721c24;
        padding: 15px;
        border: 1px solid #f5c6cb;
        border-radius: 5px;
        text-align: center;
        margin-top: 20px;
      }

      .count-info {
        text-align: center;
        color: #666;
        font-size: 0.9rem;
        margin: 15px 0;
        padding: 8px;
        background-color: #e9ecef;
        border-radius: 5px;
      }

      @media (max-width: 768px) {
        .cervejarias-grid {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 2rem;
        }

        #botaoCarregar {
          padding: 12px 25px;
          font-size: 1rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1>Cervejarias</h1>
        <p class="subtitle">Descubra cervejarias ao redor do mundo</p>
        <button id="botaoCarregar">Carregar Cervejarias</button>
      </div>

      <div id="cervejasDiv"></div>
    </div>

    <script>
      let cervejas = [];

      const carregarDiv = (cs) => {
        const div = document.getElementById("cervejasDiv");

        if (cs.length === 0) {
          div.innerHTML =
            '<div class="error">Nenhuma cervejaria encontrada.</div>';
          return;
        }

        const countInfo = `<div class="count-info">${cs.length} cervejarias encontradas</div>`;

        const itensHtml = cs.map((cervejaria) => {
          const name = cervejaria.name || "Nome não disponível";
          const type = cervejaria.brewery_type || "Tipo não informado";
          const city = cervejaria.city || "";
          const state = cervejaria.state || "";
          const country = cervejaria.country || "";

          let location = [city, state, country].filter(Boolean).join(", ");
          if (!location) location = "Localização não informada";

          return `
            <div class="cervejaria-card">
              <div class="cervejaria-name">${name}</div>
              <div class="cervejaria-type">${type}</div>
              <div class="cervejaria-details">
                <div class="cervejaria-location">${location}</div>
              </div>
            </div>
          `;
        });

        div.innerHTML =
          countInfo +
          '<div class="cervejarias-grid">' +
          itensHtml.join("") +
          "</div>";
      };

      async function carregarCervejas() {
        const botao = document.getElementById("botaoCarregar");
        const div = document.getElementById("cervejasDiv");

        try {
          botao.disabled = true;
          botao.textContent = "Carregando...";
          div.innerHTML = '<div class="loading">Buscando cervejarias</div>';

          // Primeira tentativa com a API original
          let res;
          try {
            res = await fetch(
              "https://api.openbrewerydb.org/v1/breweries?per_page=20",
              {
                method: "GET",
                headers: {
                  Accept: "application/json",
                  "Content-Type": "application/json",
                },
              }
            );
          } catch (fetchError) {
            // Se der erro de CORS, vamos usar dados de exemplo
            console.log("Erro de CORS detectado, usando dados de exemplo");
            throw new Error("CORS_ERROR");
          }

          if (!res.ok) {
            throw new Error(`Erro na API: ${res.status}`);
          }

          cervejas = await res.json();
          carregarDiv(cervejas);

          botao.textContent = "Recarregar Cervejarias";
        } catch (err) {
          console.error("Erro ao carregar cervejarias:", err);

          // Se der erro de CORS ou falha na API, usar dados de exemplo
          if (
            err.message === "CORS_ERROR" ||
            err.message.includes("Failed to fetch")
          ) {
            console.log("Carregando dados de exemplo...");
            const dadosExemplo = [
              {
                name: "Dogfish Head Brewery",
                brewery_type: "micro",
                city: "Milton",
                state: "Delaware",
                country: "United States",
              },
              {
                name: "Stone Brewing",
                brewery_type: "regional",
                city: "Escondido",
                state: "California",
                country: "United States",
              },
              {
                name: "Brewery Ommegang",
                brewery_type: "regional",
                city: "Cooperstown",
                state: "New York",
                country: "United States",
              },
              {
                name: "Bell's Brewery",
                brewery_type: "regional",
                city: "Comstock",
                state: "Michigan",
                country: "United States",
              },
              {
                name: "Sierra Nevada Brewing",
                brewery_type: "regional",
                city: "Chico",
                state: "California",
                country: "United States",
              },
              {
                name: "Samuel Adams Brewery",
                brewery_type: "large",
                city: "Boston",
                state: "Massachusetts",
                country: "United States",
              },
              {
                name: "Founders Brewing",
                brewery_type: "regional",
                city: "Grand Rapids",
                state: "Michigan",
                country: "United States",
              },
              {
                name: "Lagunitas Brewing",
                brewery_type: "regional",
                city: "Petaluma",
                state: "California",
                country: "United States",
              },
              {
                name: "New Belgium Brewing",
                brewery_type: "large",
                city: "Fort Collins",
                state: "Colorado",
                country: "United States",
              },
              {
                name: "Deschutes Brewery",
                brewery_type: "regional",
                city: "Bend",
                state: "Oregon",
                country: "United States",
              },
            ];

            // Simular um delay para parecer que está carregando
            await new Promise((resolve) => setTimeout(resolve, 1000));

            cervejas = dadosExemplo;
            carregarDiv(cervejas);

            // Mostrar aviso de que são dados de exemplo
            const countDiv = document.querySelector(".count-info");
            if (countDiv) {
              countDiv.innerHTML = `${cervejas.length} cervejarias (dados de exemplo)`;
              countDiv.style.backgroundColor = "#fff3cd";
              countDiv.style.color = "#856404";
              countDiv.style.border = "1px solid #ffeaa7";
            }

            botao.textContent = "Tentar API Novamente";
          } else {
            div.innerHTML =
              '<div class="error">Ops! Não foi possível carregar as cervejarias. Verifique sua conexão e tente novamente.</div>';
            botao.textContent = "Tentar Novamente";
          }
        } finally {
          botao.disabled = false;
        }
      }

      let botao = document.getElementById("botaoCarregar");
      botao.addEventListener("click", () => carregarCervejas());
    </script>
  </body>
</html>

